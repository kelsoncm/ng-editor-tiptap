<div class="toolbar" *ngIf="!isDisabled">
  <!-- undo / redo -->
  <div class="toolbar-group">
    <button type="button" (click)="undo()" [title]="'editor.toolbar.undo' | translate"><i class="fas fa-undo"></i></button>
    <button type="button" (click)="redo()" [title]="'editor.toolbar.redo' | translate"><i class="fas fa-redo"></i></button>
  </div>

  <ng-container *ngIf="toolbarPreset === 'minimal'">
    <div class="toolbar-group">
      <button type="button" (click)="toggleBold()" [title]="'editor.toolbar.bold' | translate"><i class="fas fa-bold"></i></button>
      <button type="button" (click)="toggleItalic()" [title]="'editor.toolbar.italic' | translate"><i class="fas fa-italic"></i></button>
      <button type="button" (click)="toggleUnderline()" [title]="'editor.toolbar.underline' | translate"><i class="fas fa-underline"></i></button>
      <button type="button" (click)="toggleStrike()" [title]="'editor.toolbar.strike' | translate"><i class="fas fa-strikethrough"></i></button>
    </div>
  </ng-container>

  <ng-container *ngIf="toolbarPreset === 'full'">
    <!-- blocos -->
    <div class="toolbar-group">
      <!-- blocos dropdown -->
      <div class="toolbar-dropdown">
        <button type="button" (click)="toggleBlocksDropdown()" class="dropdown-trigger" [title]="'editor.toolbar.blockTypes' | translate">
          <i [ngClass]="currentBlockType"></i> <i class="fas fa-chevron-down"></i>
        </button>
        <div class="dropdown-menu" *ngIf="showBlocksDropdown" (click)="$event.stopPropagation()">
          <button type="button" (click)="selectBlockType('paragraph')" class="dropdown-item">
            <i class="fas fa-paragraph"></i> {{ 'editor.blocks.paragraph' | translate }}
          </button>
          <button type="button" (click)="selectBlockType('h1')" class="dropdown-item">
            <i class="fas fa-heading"></i> {{ 'editor.blocks.heading1' | translate }}
          </button>
          <button type="button" (click)="selectBlockType('h2')" class="dropdown-item">
            <i class="fas fa-heading"></i> {{ 'editor.blocks.heading2' | translate }}
          </button>
          <button type="button" (click)="selectBlockType('h3')" class="dropdown-item">
            <i class="fas fa-heading"></i> {{ 'editor.blocks.heading3' | translate }}
          </button>
          <button type="button" (click)="selectBlockType('h4')" class="dropdown-item">
            <i class="fas fa-heading"></i> {{ 'editor.blocks.heading4' | translate }}
          </button>
          <button type="button" (click)="selectBlockType('h5')" class="dropdown-item">
            <i class="fas fa-heading"></i> {{ 'editor.blocks.heading5' | translate }}
          </button>
          <button type="button" (click)="selectBlockType('h6')" class="dropdown-item">
            <i class="fas fa-heading"></i> {{ 'editor.blocks.heading6' | translate }}
          </button>
          <hr class="dropdown-divider" />
          <button type="button" (click)="selectBlockType('quote')" class="dropdown-item">
            <i class="fas fa-quote-left"></i> {{ 'editor.blocks.quote' | translate }}
          </button>
          <button type="button" (click)="selectBlockType('code-block')" class="dropdown-item">
            <i class="fas fa-code"></i> {{ 'editor.blocks.codeBlock' | translate }}
          </button>
        </div>
      </div>

      <!-- listas -->
      <button type="button" (click)="toggleBulletList()" [title]="'editor.toolbar.bulletList' | translate"><i class="fas fa-list-ul"></i></button>
      <button type="button" (click)="toggleOrderedList()" [title]="'editor.toolbar.orderedList' | translate"><i class="fas fa-list-ol"></i></button>
    </div>

    <div class="toolbar-group">
      <!-- inline marks -->
      <button type="button" (click)="toggleBold()" [title]="'editor.toolbar.bold' | translate"><i class="fas fa-bold"></i></button>
      <button type="button" (click)="toggleItalic()" [title]="'editor.toolbar.italic' | translate"><i class="fas fa-italic"></i></button>
      
      <!-- text formatting dropdown -->
      <div class="toolbar-dropdown">
        <button type="button" (click)="toggleTextFormattingDropdown()" class="dropdown-trigger" [title]="'editor.toolbar.textFormatting' | translate">
          <i class="fas fa-font"></i> <i class="fas fa-chevron-down"></i>
        </button>
        <div class="dropdown-menu" *ngIf="showTextFormattingDropdown" (click)="$event.stopPropagation()">
          <button type="button" (click)="toggleUnderline(); closeTextFormattingDropdown()" class="dropdown-item">
            <i class="fas fa-underline"></i> {{ 'editor.toolbar.underline' | translate }}
          </button>
          <button type="button" (click)="toggleStrike(); closeTextFormattingDropdown()" class="dropdown-item">
            <i class="fas fa-strikethrough"></i> {{ 'editor.toolbar.strike' | translate }}
          </button>
          <button type="button" (click)="toggleCode(); closeTextFormattingDropdown()" class="dropdown-item">
            <i class="fas fa-code"></i> {{ 'editor.toolbar.code' | translate }}
          </button>
          <button type="button" (click)="toggleSuperscript(); closeTextFormattingDropdown()" *ngIf="enableSuperscript" class="dropdown-item">
            <i class="fas fa-superscript"></i> {{ 'editor.toolbar.superscript' | translate }}
          </button>
          <button type="button" (click)="toggleSubscript(); closeTextFormattingDropdown()" *ngIf="enableSubscript" class="dropdown-item">
            <i class="fas fa-subscript"></i> {{ 'editor.toolbar.subscript' | translate }}
          </button>
        </div>
      </div>
    </div>

    <div class="toolbar-group">
      <!-- link -->
      <button type="button" (click)="setLink()" [title]="'editor.toolbar.link' | translate"><i class="fas fa-link"></i></button>
      <button type="button" (click)="unsetLink()" [title]="'editor.toolbar.unlink' | translate"><i class="fas fa-unlink"></i></button>
    </div>

    <div class="toolbar-group" *ngIf="enableLineHeight">
      <!-- line height dropdown -->
      <div class="toolbar-dropdown">
        <button type="button" (click)="toggleLineHeightDropdown()" class="dropdown-trigger" [title]="'editor.toolbar.lineHeight' | translate">
          <i class="fas fa-text-height"></i> {{ getLineHeightLabel() }} <i class="fas fa-chevron-down"></i>
        </button>
        <div class="dropdown-menu" *ngIf="showLineHeightDropdown" (click)="$event.stopPropagation()">
          <button type="button" (click)="setLineHeight('normal')" class="dropdown-item">
            <i class="fas fa-check" [style.visibility]="currentLineHeight === 'normal' ? 'visible' : 'hidden'"></i> {{ 'editor.lineHeight.simple' | translate }}
          </button>
          <button type="button" (click)="setLineHeight('1.15')" class="dropdown-item">
            <i class="fas fa-check" [style.visibility]="currentLineHeight === '1.15' ? 'visible' : 'hidden'"></i> 1.15
          </button>
          <button type="button" (click)="setLineHeight('1.5')" class="dropdown-item">
            <i class="fas fa-check" [style.visibility]="currentLineHeight === '1.5' ? 'visible' : 'hidden'"></i> 1.5
          </button>
          <button type="button" (click)="setLineHeight('2')" class="dropdown-item">
            <i class="fas fa-check" [style.visibility]="currentLineHeight === '2' ? 'visible' : 'hidden'"></i> {{ 'editor.lineHeight.double' | translate }}
          </button>
        </div>
      </div>
    </div>

    <div class="toolbar-group" *ngIf="enableFontFamily || enableFontSize">
      <!-- font family dropdown -->
      <div class="toolbar-dropdown" *ngIf="enableFontFamily">
        <button type="button" (click)="toggleFontFamilyDropdown()" class="dropdown-trigger" [title]="'editor.toolbar.fontFamily' | translate">
          <i class="fas fa-font"></i> {{ getFontFamilyLabel() }} <i class="fas fa-chevron-down"></i>
        </button>
        <div class="dropdown-menu" *ngIf="showFontFamilyDropdown" (click)="$event.stopPropagation()">
          <button 
            type="button" 
            *ngFor="let font of fontFamilies" 
            (click)="setFontFamily(font.value)" 
            class="dropdown-item"
            [style.font-family]="font.value !== 'Default' ? font.value : 'inherit'">
            <i class="fas fa-check" [style.visibility]="currentFontFamily === font.value ? 'visible' : 'hidden'"></i> {{ font.label }}
          </button>
        </div>
      </div>

      <!-- font size dropdown -->
      <div class="toolbar-dropdown" *ngIf="enableFontSize">
        <button type="button" (click)="toggleFontSizeDropdown()" class="dropdown-trigger" [title]="'editor.toolbar.fontSize' | translate">
          <i class="fas fa-text-height"></i> {{ getFontSizeLabel() }} <i class="fas fa-chevron-down"></i>
        </button>
        <div class="dropdown-menu" *ngIf="showFontSizeDropdown" (click)="$event.stopPropagation()">
          <button 
            type="button" 
            *ngFor="let size of fontSizes" 
            (click)="setFontSize(size.value)" 
            class="dropdown-item">
            <i class="fas fa-check" [style.visibility]="currentFontSize === size.value ? 'visible' : 'hidden'"></i> {{ size.label }}
          </button>
        </div>
      </div>
    </div>

    <div class="toolbar-group" *ngIf="enableTextColor || enableHighlight">
      <!-- text color picker -->
      <div class="toolbar-color-picker" *ngIf="enableTextColor">
        <div class="toolbar-dropdown">
          <button type="button" (click)="toggleTextColorDropdown()" class="dropdown-trigger color-trigger" [title]="'editor.toolbar.textColor' | translate">
            <i class="fas fa-font"></i>
            <span class="color-preview" [style.background-color]="currentTextColor"></span>
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu color-dropdown-menu" *ngIf="showTextColorDropdown" (click)="$event.stopPropagation()">
            <div class="color-grid">
              <button 
                type="button"
                *ngFor="let color of textColors"
                class="color-option"
                [style.background-color]="color.value"
                [title]="color.label"
                (click)="selectTextColor(color.value)">
                <i class="fas fa-check" *ngIf="currentTextColor === color.value"></i>
              </button>
            </div>
            <div class="color-picker-wrapper">
              <label class="custom-color-label">
                {{ 'editor.toolbar.customColor' | translate }}
                <input type="color" [value]="currentTextColor" (change)="setTextColorFromPicker($event)" class="color-input-small">
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- highlight color picker -->
      <div class="toolbar-color-picker" *ngIf="enableHighlight">
        <div class="toolbar-dropdown">
          <button type="button" (click)="toggleHighlightColorDropdown()" class="dropdown-trigger color-trigger" [title]="'editor.toolbar.highlightColor' | translate">
            <i class="fas fa-highlighter"></i>
            <span class="color-preview" [style.background-color]="currentHighlightColor"></span>
            <i class="fas fa-chevron-down"></i>
          </button>
          <div class="dropdown-menu color-dropdown-menu" *ngIf="showHighlightColorDropdown" (click)="$event.stopPropagation()">
            <div class="color-grid">
              <button 
                type="button"
                *ngFor="let color of highlightColors"
                class="color-option"
                [style.background-color]="color.value"
                [title]="color.label"
                (click)="selectHighlightColor(color.value)">
                <i class="fas fa-check" *ngIf="currentHighlightColor === color.value"></i>
              </button>
            </div>
            <div class="color-picker-wrapper">
              <label class="custom-color-label">
                {{ 'editor.toolbar.customColor' | translate }}
                <input type="color" [value]="currentHighlightColor" (change)="setHighlightColorFromPicker($event)" class="color-input-small">
              </label>
            </div>
          </div>
        </div>
        <button type="button" (click)="removeHighlight()" [title]="'editor.toolbar.removeHighlight' | translate" class="remove-highlight-btn">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <div class="toolbar-group">
      <!-- mention dialog -->
      <button type="button" (click)="openMentionDialog()" *ngIf="enableMention" [title]="'editor.toolbar.mention' | translate"><i class="fas fa-at"></i></button>
    </div>

    <div class="toolbar-group" *ngIf="enableTable">
      <!-- Table dropdown -->
      <div class="toolbar-dropdown">
        <button type="button" (click)="toggleTableDropdown()" class="dropdown-trigger" [title]="'editor.toolbar.table' | translate">
          <i class="fas fa-table"></i> <i class="fas fa-chevron-down"></i>
        </button>
        <div class="dropdown-menu table-dropdown-menu" *ngIf="showTableDropdown" (click)="$event.stopPropagation()">
          <button type="button" (click)="insertTable()" class="dropdown-item">
            <i class="fas fa-plus"></i> {{ 'editor.table.insert' | translate }}
          </button>
          <button type="button" (click)="deleteTable()" class="dropdown-item">
            <i class="fas fa-trash"></i> {{ 'editor.table.delete' | translate }}
          </button>
          <button type="button" (click)="duplicateTable()" class="dropdown-item">
            <i class="fas fa-copy"></i> {{ 'editor.table.duplicate' | translate }}
          </button>
          <hr class="dropdown-divider" />
          <button type="button" (click)="addTableCaption()" class="dropdown-item">
            <i class="fas fa-closed-captioning"></i> {{ 'editor.table.addCaption' | translate }}
          </button>
          <button type="button" (click)="toggleCaptionPosition()" class="dropdown-item">
            <i class="fas fa-arrows-alt-v"></i> {{ 'editor.table.captionPosition' | translate }}: {{ captionPosition === 'top' ? 'Top' : 'Bottom' }}
          </button>
          <hr class="dropdown-divider" />
          <button type="button" (click)="toggleHeaderRow()" class="dropdown-item">
            <i class="fas fa-heading"></i> {{ 'editor.table.toggleHeader' | translate }}
          </button>
          <hr class="dropdown-divider" />
          <button type="button" (click)="addRowBefore()" class="dropdown-item">
            <i class="fas fa-arrow-up"></i> {{ 'editor.table.addRowBefore' | translate }}
          </button>
          <button type="button" (click)="addRowAfter()" class="dropdown-item">
            <i class="fas fa-arrow-down"></i> {{ 'editor.table.addRowAfter' | translate }}
          </button>
          <button type="button" (click)="deleteRow()" class="dropdown-item">
            <i class="fas fa-minus"></i> {{ 'editor.table.deleteRow' | translate }}
          </button>
          <hr class="dropdown-divider" />
          <button type="button" (click)="addColumnBefore()" class="dropdown-item">
            <i class="fas fa-arrow-left"></i> {{ 'editor.table.addColumnBefore' | translate }}
          </button>
          <button type="button" (click)="addColumnAfter()" class="dropdown-item">
            <i class="fas fa-arrow-right"></i> {{ 'editor.table.addColumnAfter' | translate }}
          </button>
          <button type="button" (click)="deleteColumn()" class="dropdown-item">
            <i class="fas fa-minus"></i> {{ 'editor.table.deleteColumn' | translate }}
          </button>
          <hr class="dropdown-divider" />
          <button type="button" (click)="mergeCells()" class="dropdown-item">
            <i class="fas fa-compress"></i> {{ 'editor.table.mergeCells' | translate }}
          </button>
          <button type="button" (click)="splitCell()" class="dropdown-item">
            <i class="fas fa-expand"></i> {{ 'editor.table.splitCell' | translate }}
          </button>
          <hr class="dropdown-divider" />
          <div class="toolbar-dropdown nested-dropdown">
            <button type="button" (click)="toggleTableCellAlignDropdown()" class="dropdown-item">
              <i class="fas fa-align-justify"></i> {{ 'editor.table.cellAlign' | translate }} <i class="fas fa-chevron-right"></i>
            </button>
            <div class="dropdown-menu nested-menu" *ngIf="showTableCellAlignDropdown" (click)="$event.stopPropagation()">
              <button type="button" (click)="setCellVerticalAlign('top')" class="dropdown-item">
                <i class="fas fa-arrow-up"></i> {{ 'editor.table.alignTop' | translate }}
              </button>
              <button type="button" (click)="setCellVerticalAlign('middle')" class="dropdown-item">
                <i class="fas fa-arrows-alt-h"></i> {{ 'editor.table.alignMiddle' | translate }}
              </button>
              <button type="button" (click)="setCellVerticalAlign('bottom')" class="dropdown-item">
                <i class="fas fa-arrow-down"></i> {{ 'editor.table.alignBottom' | translate }}
              </button>
            </div>
          </div>
          <hr class="dropdown-divider" />
          <div class="toolbar-dropdown nested-dropdown">
            <button type="button" (click)="toggleTableCellBackgroundDropdown()" class="dropdown-item">
              <i class="fas fa-fill-drip"></i> {{ 'editor.table.cellBackground' | translate }} <i class="fas fa-chevron-right"></i>
            </button>
            <div class="dropdown-menu nested-menu color-dropdown-menu" *ngIf="showTableCellBackgroundDropdown" (click)="$event.stopPropagation()">
              <div class="color-grid">
                <button 
                  type="button"
                  *ngFor="let color of textColors"
                  class="color-option"
                  [style.background-color]="color.value"
                  [title]="color.label"
                  (click)="selectCellBackground(color.value)">
                  <i class="fas fa-check" *ngIf="currentTableCellBackground === color.value"></i>
                </button>
              </div>
              <div class="color-picker-wrapper">
                <label class="custom-color-label">
                  {{ 'editor.toolbar.customColor' | translate }}
                  <input type="color" [value]="currentTableCellBackground" (change)="setCellBackgroundFromPicker($event)" class="color-input-small">
                </label>
              </div>
              <button type="button" (click)="removeCellBackground()" class="dropdown-item">
                <i class="fas fa-times"></i> {{ 'editor.table.removeBackground' | translate }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>

</div>

<!-- Mention Dialog -->
<div class="mention-dialog-overlay" *ngIf="showMentionDialog" (click)="closeMentionDialog()">
  <div class="mention-dialog" (click)="$event.stopPropagation()">
    <div class="mention-dialog-header">
      <h3>{{ 'editor.dialogs.mentionTitle' | translate }}</h3>
      <button class="close-btn" (click)="closeMentionDialog()">Ã—</button>
    </div>
    <div class="mention-dialog-content">
      <button
        *ngFor="let item of mentionItems"
        class="mention-dialog-item"
        (click)="insertMention(item)">
        {{ item.label }}
      </button>
    </div>
  </div>
</div>

<!-- Balloon Context Menu -->
<div 
  class="balloon-menu" 
  *ngIf="enableBalloonMenu && showBalloonMenu"
  [style.top]="balloonMenuPosition.top"
  [style.left]="balloonMenuPosition.left"
  (click)="$event.stopPropagation()">
  <button 
    type="button" 
    class="balloon-button" 
    (click)="toggleBold(); closeBalloonMenu()"
    [title]="'editor.balloonMenu.bold' | translate">
    <i class="fas fa-bold"></i>
  </button>
  <button 
    type="button" 
    class="balloon-button" 
    (click)="toggleItalic(); closeBalloonMenu()"
    [title]="'editor.balloonMenu.italic' | translate">
    <i class="fas fa-italic"></i>
  </button>
  <button 
    type="button" 
    class="balloon-button" 
    (click)="toggleStrike(); closeBalloonMenu()"
    [title]="'editor.balloonMenu.strike' | translate">
    <i class="fas fa-strikethrough"></i>
  </button>
  <button 
    type="button" 
    class="balloon-button" 
    (click)="toggleUnderline(); closeBalloonMenu()"
    [title]="'editor.balloonMenu.underline' | translate">
    <i class="fas fa-underline"></i>
  </button>
  <button 
    type="button" 
    class="balloon-button" 
    (click)="toggleCode(); closeBalloonMenu()"
    [title]="'editor.balloonMenu.code' | translate">
    <i class="fas fa-code"></i>
  </button>
  <button 
    type="button" 
    class="balloon-button" 
    (click)="toggleSubscript(); closeBalloonMenu()"
    *ngIf="enableSubscript"
    [title]="'editor.balloonMenu.subscript' | translate">
    <i class="fas fa-subscript"></i>
  </button>
  <button 
    type="button" 
    class="balloon-button" 
    (click)="toggleSuperscript(); closeBalloonMenu()"
    *ngIf="enableSuperscript"
    [title]="'editor.balloonMenu.superscript' | translate">
    <i class="fas fa-superscript"></i>
  </button>
  <div class="balloon-divider"></div>
  <button 
    type="button" 
    class="balloon-button" 
    (click)="setLink(); closeBalloonMenu()"
    [title]="'editor.balloonMenu.link' | translate">
    <i class="fas fa-link"></i>
  </button>
</div>

<div
  #editorElement
  class="editor-surface"
  [style.min-height]="minHeight">
</div>
